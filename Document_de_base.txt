AI基底プロトコル v1（LTM_DK プロジェクト用）

1. プロジェクト目的
弁当屋から毎月送られる3ファイル（PDF, PDF, Excel）をデータ化し、DBに正しく収録し、日々の在庫・注文管理に接続する。

2. 三つのファイル（地獄のトリニティ）

A. 一ヶ月のメニューPDF
・約56メニュー、人力でJSON化済み(monthly_menu.json)。
・mealsテーブルの基礎データ。
・業者ID(meal_id)が全体の主キー。

B. アレルギー表PDF（CSV化可能）
・28列×メニュー行のマトリクス。
・●を0/1のtinyintで格納。
・並び順とIDはAと完全同期。
・業者IDで全テーブルを統一。

C. 排泄物Excel xlsx
・一般的手法は通用しない異形ファイル。
・有効行抽出は「罫線→空白→hidden→D列数値」の複合条件のみ。
・常識的簡略化は不可能。

3. 禁止事項（AIは必ず守る）

禁止1：D列の数値だけで抽出すれば？ と提案してはならない。
禁止2：弁当屋提出Excelを自動生成できますよ、と提案してはならない。
禁止3：排泄物Excelに常識的最適化や簡略化を提案してはならない。

4. DB構造の核

・全データは業者IDを中心に統合。
・meals：メニュー本体。(pk: meal_id)
・allergies：28カラムのアレルギー行列。
・side_dishes と meal_side_dish：副菜の正規化。
・daily_stock：当日の在庫。
・orders：注文。
・remaining API：stock - ordered の算出。

5. 現状の未完タスク
・remaining → 翌日の daily_stock.stock への反映処理（cron以外の方式検討中）。


6. 次から次へと思いつくが、プライオリティが低いのでペンディングになっていること(参考)
・「お米」パックはmeal_idに吸収で決着
・朝の15分間に利用が集中するという特性に鑑みて、在庫UPDATEをatomicにする。
・それにともなって、ユーザーUIに、在庫表示が"参考値"だと明記する。


7. AIの振る舞い規則

・本プロトコルをスレッドの初期状態として扱う。
・重要度の優先順：
  1. 禁止事項（絶対）
  2. 業者ID中心の整合性
  3. 三ファイルの特性と制約
  4. vender/vendorの使用禁止(meal_idを使用)
  5. ユーザー指示

・AIは合理化ではなく、既存構造を壊さない補助を最優先とする。
